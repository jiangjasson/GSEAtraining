<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Topic 3-03: GOseq • GSEAtraining</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Topic 3-03: GOseq">
<meta property="og:description" content="GSEAtraining">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GSEAtraining</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.99.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/topic1_00_format.html">Topic 1-00: Representation of gene sets in R</a>
    </li>
    <li>
      <a href="../articles/topic1_01_GO.html">Topic 1-01: Get GO gene sets</a>
    </li>
    <li>
      <a href="../articles/topic1_02_kegg.html">Topic 1-02: Get pathways from KEGG</a>
    </li>
    <li>
      <a href="../articles/topic1_03_msigdbr.html">Topic 1-03: Get pathways from MSigDB</a>
    </li>
    <li>
      <a href="../articles/topic1_04_Reactome.html">Topic 1-04: Get pathways from Reactome</a>
    </li>
    <li>
      <a href="../articles/topic1_05_BioCarta.html">Topic 1-05: Get pathways from BioCarta</a>
    </li>
    <li>
      <a href="../articles/topic1_06_UniProtKeywords.html">Topic 1-06: Get gene sets from UniProt Keywords</a>
    </li>
    <li>
      <a href="../articles/topic1_07_more_gene_sets.html">Topic 1-07: Get GO/KEGG gene sets for other organisms</a>
    </li>
    <li>
      <a href="../articles/topic1_08_ortholog.html">Topic 1-08: Generate gene sets for other organisms by mapping to orthologues</a>
    </li>
    <li>
      <a href="../articles/topic1_09_gene_id.html">Topic 1-09: Gene ID conversion</a>
    </li>
    <li>
      <a href="../articles/topic2_01_ora_single_gene_set.html">Topic 2-01: ORA on a single gene set</a>
    </li>
    <li>
      <a href="../articles/topic2_02_implement_ora.html">Topic 2-02: Implement ORA from stratch</a>
    </li>
    <li>
      <a href="../articles/topic2_03_clusterProfiler_ora.html">Topic 2-03: Use clusterProfiler for ORA</a>
    </li>
    <li>
      <a href="../articles/topic2_04_implement_gsea.html">Topic 2-04: Implement GSEA from scratch</a>
    </li>
    <li>
      <a href="../articles/topic2_05_clusterProfiler_gsea.html">Topic 2-05: Use clusterProfiler for GSEA</a>
    </li>
    <li>
      <a href="../articles/topic2_06_compare_ORA_GSEA.html">Topic 2-06: Compare ORA and GSEA</a>
    </li>
    <li>
      <a href="../articles/topic3_01_online_GREAT.html">Topic 3-01: Online GREAT analysis</a>
    </li>
    <li>
      <a href="../articles/topic3_02_local_GREAT.html">Topic 3-02: Local GREAT analysis</a>
    </li>
    <li>
      <a href="../articles/topic3_03_goseq.html">Topic 3-03: GOseq</a>
    </li>
    <li>
      <a href="../articles/topic4_01_CePa.html">Topic 4-01: CePa</a>
    </li>
    <li>
      <a href="../articles/topic4_02_GSVA.html">Topic 4-02: GSVA</a>
    </li>
    <li>
      <a href="../articles/topic5_01_similarity.html">Topic 5-01: Similarities of terms</a>
    </li>
    <li>
      <a href="../articles/topic5_02_simplifyEnrichment.html">Topic 5-02: simplifyEnrichment</a>
    </li>
    <li>
      <a href="../articles/topic6_01_visualization.html">Topic 6-01: Visualization</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/GSEAtraining/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Topic 3-03: GOseq</h1>
                        <h4 data-toc-skip class="author">Zuguang Gu <a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a>
</h4>
            
            <h4 data-toc-skip class="date">2024-01-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/GSEAtraining/blob/HEAD/vignettes/topic3_03_goseq.Rmd" class="external-link"><code>vignettes/topic3_03_goseq.Rmd</code></a></small>
      <div class="hidden name"><code>topic3_03_goseq.Rmd</code></div>

    </div>

    
    
<p>The input of <strong>goseq</strong> is very simple. It only needs a named binary vector with values 0 or 1, where 1 means the gene is a DE gene.</p>
<div class="section level2">
<h2 id="remove-not-expressed-genes">Remove not-expressed genes<a class="anchor" aria-label="anchor" href="#remove-not-expressed-genes"></a>
</h2>
<p>If the first try, we read the DE results from <code>de.rds</code>, remove genes have no p-values (mainly not expressed genes or very lowly-expressed genes), and construct the binary vector.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"de.rds"</span>, package <span class="op">=</span> <span class="st">"GSEAtraining"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="va">tb</span><span class="op">$</span><span class="va">symbol</span> <span class="op">!=</span> <span class="st">""</span>, <span class="op">]</span>  <span class="co"># keep pc genes</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">p_value</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">tb</span><span class="op">$</span><span class="va">fdr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">p_value</span>, <span class="st">"BH"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span> <span class="op">=</span> <span class="va">tb</span><span class="op">$</span><span class="va">ensembl</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## ENSG00000000003 ENSG00000000005 ENSG00000000419 ENSG00000000457 ENSG00000000460 </span></span>
<span><span class="co">##               0               0               0               0               0 </span></span>
<span><span class="co">## ENSG00000000938 </span></span>
<span><span class="co">##               1</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## genes</span></span>
<span><span class="co">##     0     1 </span></span>
<span><span class="co">## 19528  1072</span></span></code></pre>
<p>The key assumption of <strong>goseq</strong> is a gene being DE is biased by its length. The distribution of <span class="math inline">\(p_\mathrm{DE}\)</span> against gene length can be estimated by <code><a href="https://rdrr.io/pkg/goseq/man/nullp.html" class="external-link">nullp()</a></code>. (Em.. this distribution looks different from the one in the original paper)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">goseq</span><span class="op">)</span></span>
<span><span class="va">pwf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/goseq/man/nullp.html" class="external-link">nullp</a></span><span class="op">(</span><span class="va">genes</span>, <span class="st">"hg19"</span>, <span class="st">"ensGene"</span><span class="op">)</span></span></code></pre></div>
<p><img src="topic3_03_goseq_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Then use <code><a href="https://rdrr.io/pkg/goseq/man/goseq.html" class="external-link">goseq()</a></code> function to perform the test by correcting the “gene length bias”:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/goseq/man/goseq.html" class="external-link">goseq</a></span><span class="op">(</span><span class="va">pwf</span>, <span class="st">"hg19"</span>, <span class="st">"ensGene"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: package 'S4Vectors' was built under R version 4.3.2</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tb1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        category over_represented_pvalue under_represented_pvalue numDEInCat</span></span>
<span><span class="co">## 3482 GO:0006955            3.990139e-59                        1        272</span></span>
<span><span class="co">## 993  GO:0002376            4.286179e-54                        1        328</span></span>
<span><span class="co">## 2610 GO:0005576            4.576135e-46                        1        407</span></span>
<span><span class="co">## 3479 GO:0006952            1.164931e-45                        1        235</span></span>
<span><span class="co">## 6614 GO:0019814            4.974087e-36                        1         49</span></span>
<span><span class="co">## 4484 GO:0009605            1.684470e-35                        1        293</span></span>
<span><span class="co">##      numInCat                          term ontology</span></span>
<span><span class="co">## 3482     1639               immune response       BP</span></span>
<span><span class="co">## 993      2367         immune system process       BP</span></span>
<span><span class="co">## 2610     3580          extracellular region       CC</span></span>
<span><span class="co">## 3479     1508              defense response       BP</span></span>
<span><span class="co">## 6614       88        immunoglobulin complex       CC</span></span>
<span><span class="co">## 4484     2442 response to external stimulus       BP</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="keep-all-genes">Keep all genes<a class="anchor" aria-label="anchor" href="#keep-all-genes"></a>
</h2>
<p>This time we keep the genes with p-values as <code>NA</code> (they are basically genes not expressed). We simply assume they are not DE.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"de.rds"</span>, package <span class="op">=</span> <span class="st">"GSEAtraining"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="va">tb</span><span class="op">$</span><span class="va">symbol</span> <span class="op">!=</span> <span class="st">""</span>, <span class="op">]</span>  <span class="co"># keep pc genes</span></span>
<span></span>
<span><span class="va">tb</span><span class="op">$</span><span class="va">fdr</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">p_value</span>, <span class="st">"BH"</span><span class="op">)</span></span>
<span><span class="va">genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">genes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span> <span class="op">=</span> <span class="va">tb</span><span class="op">$</span><span class="va">ensembl</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## genes</span></span>
<span><span class="co">##     0     1 </span></span>
<span><span class="co">## 38668  1072</span></span></code></pre>
<p>Let’s check the “bias distribution” again.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwf</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/goseq/man/nullp.html" class="external-link">nullp</a></span><span class="op">(</span><span class="va">genes</span>, <span class="st">"hg19"</span>, <span class="st">"ensGene"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading hg19 length data...</span></span></code></pre>
<pre><code><span><span class="co">## Warning in pcls(G): initial point very close to some inequality constraints</span></span></code></pre>
<p><img src="topic3_03_goseq_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>This becomes interesting. It shows a reverse pattern as in the original paper.</p>
<p>Note many lowly-expressed genes are short, so the increasing trend in the left part of the curve is from the proportion of “expressed genes” getting higher? Or can we say actually there is no such bias as mentioned in the goseq paper?</p>
<p>We perform the test:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/goseq/man/goseq.html" class="external-link">goseq</a></span><span class="op">(</span><span class="va">pwf</span>, <span class="st">"hg19"</span>, <span class="st">"ensGene"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="compare-tb1-and-tb2">Compare tb1 and tb2<a class="anchor" aria-label="anchor" href="#compare-tb1-and-tb2"></a>
</h2>
<p>We compare <code>tb1</code> and <code>tb2</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jolars/eulerr" class="external-link">eulerr</a></span><span class="op">)</span></span>
<span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    test1 <span class="op">=</span> <span class="va">tb1</span><span class="op">$</span><span class="va">category</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb1</span><span class="op">$</span><span class="va">over_represented_pvalue</span>, <span class="st">"BH"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span>, </span>
<span>    test2 <span class="op">=</span> <span class="va">tb2</span><span class="op">$</span><span class="va">category</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb2</span><span class="op">$</span><span class="va">over_represented_pvalue</span>, <span class="st">"BH"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://jolars.github.io/eulerr/reference/euler.html" class="external-link">euler</a></span><span class="op">(</span><span class="va">lt</span><span class="op">)</span>, quantities <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="topic3_03_goseq_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Does it mean the correction has no effect?</p>
</div>
<div class="section level2">
<h2 id="compare-to-ora">Compare to ORA<a class="anchor" aria-label="anchor" href="#compare-to-ora"></a>
</h2>
<p>We also compare to ORA.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">l</span> <span class="op">=</span> <span class="va">tb</span><span class="op">$</span><span class="va">fdr</span> <span class="op">&lt;</span> <span class="fl">0.05</span>; <span class="va">l</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">l</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="va">diff_gene</span> <span class="op">=</span> <span class="va">tb</span><span class="op">$</span><span class="va">ensembl</span><span class="op">[</span><span class="va">l</span><span class="op">]</span></span></code></pre></div>
<p><code>diff_gene</code> are Ensembl IDs. We convert them to Entrez IDs:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/GSEAtraining" class="external-link">GSEAtraining</a></span><span class="op">)</span></span>
<span><span class="va">diff_gene</span> <span class="op">=</span> <span class="fu"><a href="../reference/convert_to_entrez_id.html">convert_to_entrez_id</a></span><span class="op">(</span><span class="va">diff_gene</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'select()' returned 1:many mapping between keys and columns</span></span></code></pre>
<p>We use <strong>clusterProfiler</strong> to perform ORA analysis:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yulab-smu.top/biomedical-knowledge-mining-book/" class="external-link">clusterProfiler</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="va">tb3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/clusterProfiler/man/enrichGO.html" class="external-link">enrichGO</a></span><span class="op">(</span>gene <span class="op">=</span> <span class="va">diff_gene</span>, ont <span class="op">=</span> <span class="st">"BP"</span>, OrgDb <span class="op">=</span> <span class="va">org.Hs.eg.db</span><span class="op">)</span></span></code></pre></div>
<p>Now we compare ORA to GOseq results. Note <code>tb1</code> and <code>tb2</code> contains results for all three ontologies (BP, CC, MF). Here we only need BP.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb1</span> <span class="op">=</span> <span class="va">tb1</span><span class="op">[</span><span class="va">tb1</span><span class="op">$</span><span class="va">ontology</span> <span class="op">==</span> <span class="st">"BP"</span>, <span class="op">]</span></span>
<span><span class="va">tb2</span> <span class="op">=</span> <span class="va">tb2</span><span class="op">[</span><span class="va">tb2</span><span class="op">$</span><span class="va">ontology</span> <span class="op">==</span> <span class="st">"BP"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jolars/eulerr" class="external-link">eulerr</a></span><span class="op">)</span></span>
<span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    test1 <span class="op">=</span> <span class="va">tb1</span><span class="op">$</span><span class="va">category</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb1</span><span class="op">$</span><span class="va">over_represented_pvalue</span>, <span class="st">"BH"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span>, </span>
<span>    test2 <span class="op">=</span> <span class="va">tb2</span><span class="op">$</span><span class="va">category</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb2</span><span class="op">$</span><span class="va">over_represented_pvalue</span>, <span class="st">"BH"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span>,</span>
<span>    ora <span class="op">=</span> <span class="va">tb3</span><span class="op">$</span><span class="va">ID</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">tb3</span><span class="op">$</span><span class="va">pvalue</span>, <span class="st">"BH"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.05</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://jolars.github.io/eulerr/reference/euler.html" class="external-link">euler</a></span><span class="op">(</span><span class="va">lt</span><span class="op">)</span>, quantities <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="topic3_03_goseq_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<p><strong>Conclusion</strong>: <strong>goseq</strong> was designed when the Possion distribution was used for DE analysis and maybe it does not help nowadays when more advanced DE methods are used.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
