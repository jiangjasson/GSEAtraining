## -----------------------------------------------------------------------------
lt = readRDS(system.file("extdata", "ora.rds", package = "GSEAtraining"))
bg_gene = lt$bg_gene
diff_gene = lt$diff_gene
gene_set = lt$gene_set

## -----------------------------------------------------------------------------
length(bg_gene)  # background genes
length(diff_gene)
length(gene_set)
length(intersect(diff_gene, gene_set))  # genes in the gene set

## ----eval = FALSE-------------------------------------------------------------
# diff_gene = intersect(diff_gene, bg_gene)
# gene_set = intersect(gene_set, bg_gene)

## -----------------------------------------------------------------------------
1 - phyper(14-1, 200, 38392, 968)
# or
phyper(14-1, 200, 38392, 968, lower.tail = FALSE)

## -----------------------------------------------------------------------------
1 - phyper(14-1, 968, 37624, 200)

## -----------------------------------------------------------------------------
fisher.test(matrix(c(14, 186, 954, 37438), nrow = 2))

## -----------------------------------------------------------------------------
1 - pbinom(14-1, 200, 968/38592)

## -----------------------------------------------------------------------------
1 - pbinom(14-1, 968, 200/38592)

## -----------------------------------------------------------------------------
chisq.test(matrix(c(14, 186, 954, 37438), nrow = 2), correct = FALSE)

## -----------------------------------------------------------------------------
p1 = 14/200
p2 = 954/38392
p = 968/38592

z = abs(p1 - p2)/sqrt(p*(1-p))/sqrt(1/200 + 1/38392)
2*pnorm(z, lower.tail = FALSE)
z^2

## -----------------------------------------------------------------------------
p1 = 14/968
p2 = 186/37624
p = 200/38592

z = abs(p1 - p2)/sqrt(p*(1-p))/sqrt(1/968 + 1/37624)
2*pnorm(z, lower.tail = FALSE)
z^2

## -----------------------------------------------------------------------------
library(microbenchmark)

microbenchmark(
	hyper = 1 - phyper(13, 200, 38392, 968),
	fisher = fisher.test(matrix(c(14, 186, 954, 37438), nrow = 2)),
	binom = 1 - pbinom(13, 968, 200/38592),
	chisq = chisq.test(matrix(c(14, 186, 954, 37438), nrow = 2), correct = FALSE),
	ztest = {
		p1 = 14/200
		p2 = 954/38392
		p = 968/38592

		z = abs(p1 - p2)/sqrt(p*(1-p))/sqrt(1/200 + 1/38392)
		2*pnorm(z, lower.tail = FALSE)
	},
	times = 1000
)

## -----------------------------------------------------------------------------
1 - phyper(13, 200, 38392, 968)
1 - phyper(13, 200, 38392 - 10000, 968)
1 - phyper(13, 200, 38392 - 20000, 968)
1 - phyper(13, 200, 38392 + 10000, 968)
1 - phyper(13, 200, 38392 + 20000, 968)

## -----------------------------------------------------------------------------
1 - phyper(13, 200, 38392, 968)
1 - phyper(13-3, 200, 38392, 968)
1 - phyper(13+3, 200, 38392, 968)

